<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Webbluetoothwithcc2541 : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Webbluetoothwithcc2541</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/DeqingSun/webBluetoothWithCC2541">View on GitHub</a>

          <h1 id="project_title">Webbluetoothwithcc2541</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/DeqingSun/webBluetoothWithCC2541/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/DeqingSun/webBluetoothWithCC2541/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="webbluetooth-with-cc2541" class="anchor" href="#webbluetooth-with-cc2541" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebBluetooth With CC2541</h1>

<p><img src="https://raw.githubusercontent.com/DeqingSun/webBluetoothWithCC2541/master/images/ChromeWebBluetooth.gif" alt=""></p>

<p>This project shares my experience with WebBluetooth with Bluetooth hardware (CC2541 - Texas Instruments) </p>

<h2>
<a id="hardware-platform" class="anchor" href="#hardware-platform" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hardware Platform</h2>

<p>I used a Texas Instruments CC2541 dev board with original "SimpleBLEPeripheral" example. The example come with TI's BLE-Stack package. This example should work on all CC254x board as the example don't need any mandatory hardware to work.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/webBluetoothWithCC2541/master/images/cc2541project.png" alt=""></p>

<p>"SimpleBLEPeripheral" example works as a BLE peripheral. By default, it will be either advertising or connected, never turn off. The example has only one service with UUID 0xFFF0.</p>

<p>The 0xFFF0 service has 5 characteristics:</p>

<table>
<thead>
<tr>
<th>UUID</th>
<th align="center">User Description</th>
<th>Properties</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xFFF1</td>
<td align="center">Characteristic 1</td>
<td>Read Write</td>
<td>uint8</td>
</tr>
<tr>
<td>0xFFF2</td>
<td align="center">Characteristic 2</td>
<td>Read</td>
<td>uint8</td>
</tr>
<tr>
<td>0xFFF3</td>
<td align="center">Characteristic 3</td>
<td>Write</td>
<td>uint8</td>
</tr>
<tr>
<td>0xFFF4</td>
<td align="center">Characteristic 4</td>
<td>Notify</td>
<td>uint8</td>
</tr>
<tr>
<td>0xFFF5</td>
<td align="center">Characteristic 5</td>
<td>Read</td>
<td>uint8[5]</td>
</tr>
</tbody>
</table>

<p>I used Characteristic 1 only. Also I can read it's value on dev board's LCD screen.</p>

<h2>
<a id="webbluetooth-api" class="anchor" href="#webbluetooth-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebBluetooth API</h2>

<p>There is a good explanation of webBluetooth API on:</p>

<p><a href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web">https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web</a></p>

<p>Also there is a tool to generate code to access bluetooth devices. You can type the filter condition, service and characteristic's UUID. This webpage will generate all core code immediately.</p>

<p><a href="https://beaufortfrancois.github.io/sandbox/web-bluetooth/generator/">https://beaufortfrancois.github.io/sandbox/web-bluetooth/generator/</a></p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/webBluetoothWithCC2541/master/images/generator.png" alt=""></p>

<p>I will share what I learned for developers without much Javascript knowledge like me. All accesses to WebBluetooth API are asynchronous. You can not expect to get what you want immediately. Rather that registering all functions with messy nested callbacks, WebBluetooth API used <a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises">Promises</a>. So you can write async requests in a linear way rather than nested.</p>

<p>I'll use my code as example.</p>

<pre><code>document.getElementById('buttonConnect').addEventListener('click', function() {
  simpleBLEPeripheral.request()
  .then(_ =&gt; simpleBLEPeripheral.connect())
  .then(_ =&gt; {return simpleBLEPeripheral.readCharacteristicOne();})
  .then(value =&gt; {return simpleBLEPeripheral.writeCharacteristicOne(new Uint8Array([value.getUint8() + 1]));})
  .then(_ =&gt; {return simpleBLEPeripheral.readCharacteristicOne()})
  .catch(error =&gt; {
     console.log(error)
  });
});
</code></pre>

<p>When a "then" block returns another Promise, next "then" block will hold on until the previous async request is finished.</p>

<p>Data you read from BLE device is in a DataView object. You can get it's value using getUint8() or other similar methods. You can use a Uint8Array object to write to BLE device.</p>

<h2>
<a id="get-connected" class="anchor" href="#get-connected" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get Connected</h2>

<p>To use WebBluetooth API, you need either enable WebBluetooth flag in chrome://flags/#enable-web-bluetooth</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/webBluetoothWithCC2541/master/images/flags.png" alt=""></p>

<p>Or you can use Origin Trials on your webpage. I'm still waiting for my token.</p>

<p>Finally you can host your page on localhost or a https server. You can also try mine on </p>

<p><a href="https://deqingsun.github.io/webBluetoothWithCC2541/webBluetoothSimpleBLEPeripheral.html">https://deqingsun.github.io/webBluetoothWithCC2541/webBluetoothSimpleBLEPeripheral.html</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Webbluetoothwithcc2541 maintained by <a href="https://github.com/DeqingSun">DeqingSun</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
